---
/**
 * Product Detail Page - /products/[slug]
 * Fetches product data from Worker API and renders the product page
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProductConfigurator from '../../components/ProductConfigurator.tsx';
import ContactFormPopup from '../../components/ContactFormPopup.tsx';
import '../../styles/steps.css';
import {
  siteConfig,
  getProductSchema,
  getBreadcrumbSchema,
  getFAQSchema,
  truncateDescription,
  stripHtml
} from '../../config/seo';

const WORKER_URL = 'https://hercules-product-sync-uk.gilles-86d.workers.dev';

// Get product slug from URL
const { slug } = Astro.params;

// Fetch product data
let product = null;
let error = null;

try {
  const response = await fetch(`${WORKER_URL}/product/${slug}`);
  if (response.ok) {
    product = await response.json();
  } else {
    error = `Product not found: ${slug}`;
  }
} catch (e) {
  error = `Failed to load product: ${e instanceof Error ? e.message : 'Unknown error'}`;
}

// Helper to format price
const formatPrice = (price: number | string) => {
  const num = typeof price === 'string' ? parseFloat(price) : price;
  return `â‚¬${num.toFixed(2).replace('.', ',')}`;
};

// Get conditional prices for display (use first variation with prices)
const getConditionalPrices = () => {
  if (!product?.variations?.length) return [];
  const variation = product.variations.find((v: any) => v.conditional_prices?.length);
  return variation?.conditional_prices || [];
};

// Get price range from all variations
const getPriceRange = () => {
  if (!product?.variations?.length) return null;

  let minPrice = Infinity;
  let maxPrice = 0;

  for (const variation of product.variations) {
    if (variation.conditional_prices?.length) {
      for (const cp of variation.conditional_prices) {
        if (cp.price < minPrice) minPrice = cp.price;
        if (cp.price > maxPrice) maxPrice = cp.price;
      }
    }
  }

  if (minPrice === Infinity) return null;
  return { min: minPrice, max: maxPrice };
};

const conditionalPrices = getConditionalPrices();
const priceRange = getPriceRange();

// Generate WordPress thumbnail URL at specific size
const wpThumb = (url: string, size: number) => {
  if (!url) return url;
  return url.replace(/\.(jpg|jpeg|png|gif|webp)$/i, `-${size}x${size}.$1`);
};

// Generate Worker API image URL (cached on Cloudflare edge, served as WebP)
const workerImage = (index: number) => `${WORKER_URL}/image/${slug}/${index}`;
const workerThumb = (index: number) => `${WORKER_URL}/image/${slug}/${index}?size=thumb`;

// Convert image URL to WebP format (WordPress fallback)
const toWebP = (url: string) => {
  if (!url || url.endsWith('.webp')) return url;
  return url + '.webp';
};

// Get gallery images - Worker cached for fast LCP, WordPress for high-quality upgrade
const getGalleryImages = () => {
  if (!product?.images?.length) return [];
  return product.images.map((img: any, index: number) => {
    // Worker API images (cached on Cloudflare edge, WebP format) - fast but 361x361
    const workerSrc = workerImage(index);
    const workerThumbSrc = workerThumb(index);

    // WordPress full-size URL - higher quality for progressive enhancement
    const fullSrc = img.src || img.local_src;

    return {
      src: workerSrc,           // Worker cached image for fast LCP (361x361)
      srcFull: fullSrc,         // Full WordPress URL for high-quality upgrade
      srcset: '',               // No srcset - we'll upgrade via JS after load
      alt: img.alt || product.name,
      thumbnail: workerThumbSrc, // Thumbnail from Worker (fast)
    };
  });
};

const galleryImages = getGalleryImages();

// Fetch related products (products NOT in the same categories as current product)
let relatedProducts: any[] = [];
if (product) {
  try {
    const allProductsRes = await fetch(`${WORKER_URL}/products`);
    if (allProductsRes.ok) {
      const allProducts = await allProductsRes.json();
      // Get current product's category slugs
      const currentCategories = product.categories?.map((c: any) =>
        typeof c === 'string' ? c : c.slug
      ) || [];
      // Filter products that are NOT in the same categories and not the current product
      const otherProducts = allProducts.filter((p: any) => {
        if (p.slug === slug) return false;
        const pCategories = p.categories || [];
        // Check if any category overlaps
        const hasOverlap = pCategories.some((cat: string) => currentCategories.includes(cat));
        return !hasOverlap;
      });
      // Shuffle and take 5 random products
      const shuffled = otherProducts.sort(() => Math.random() - 0.5);
      relatedProducts = shuffled.slice(0, 5);
    }
  } catch (error) {
    console.error('Error fetching related products:', error);
  }
}

// Generate static paths for all products
export async function getStaticPaths() {
  const WORKER_URL = 'https://hercules-product-sync-uk.gilles-86d.workers.dev';

  try {
    const response = await fetch(`${WORKER_URL}/products`);
    const products = await response.json();

    return products
      .filter((p: any) => p.slug)
      .map((product: any) => ({
        params: { slug: product.slug },
      }));
  } catch (e) {
    console.error('Failed to fetch products for static paths:', e);
    return [];
  }
}

// SEO Data
const productUrl = `${siteConfig.siteUrl}/products/${slug}/`;
const productDescription = product?.short_description
  ? truncateDescription(stripHtml(product.short_description))
  : product?.description
    ? truncateDescription(stripHtml(product.description))
    : siteConfig.defaultDescription;

const productImage = galleryImages[0]?.src || `${siteConfig.siteUrl}${siteConfig.defaultImage}`;

// Build breadcrumb schema
const breadcrumbItems = [
  { name: 'Home', url: siteConfig.siteUrl },
];
if (product?.categories?.[0]) {
  const cat = product.categories[0];
  const catName = typeof cat === 'string' ? cat : cat.name;
  const catSlug = typeof cat === 'string' ? cat : cat.slug;
  breadcrumbItems.push({
    name: catName,
    url: `${siteConfig.siteUrl}/collections/${catSlug}/`
  });
}
if (product) {
  breadcrumbItems.push({
    name: product.name,
    url: productUrl
  });
}

// Build JSON-LD schemas
const jsonLdSchemas: object[] = [];

if (product) {
  // Product schema
  jsonLdSchemas.push(getProductSchema({
    name: product.name,
    description: productDescription,
    image: productImage,
    url: productUrl,
    sku: product.sku || `HERC-${product.id}`,
    brand: siteConfig.siteName,
    priceMin: priceRange?.min,
    priceMax: priceRange?.max,
    currency: 'EUR',
    availability: 'InStock',
    condition: 'NewCondition'
  }));

  // Breadcrumb schema
  jsonLdSchemas.push(getBreadcrumbSchema(breadcrumbItems));

  // FAQ schema (if product has FAQ data)
  const faqSchema = getFAQSchema(product.faq);
  if (faqSchema) {
    jsonLdSchemas.push(faqSchema);
  }
}
---

<BaseLayout
  title={product?.name || 'Product'}
  description={productDescription}
  pageType="product"
  ogType="product"
  ogImage={productImage}
  productPrice={priceRange?.min?.toString()}
  productCurrency="EUR"
  productAvailability="InStock"
  jsonLd={jsonLdSchemas}
  preloadLcpImage={galleryImages[0] ? {
    src: galleryImages[0].src
  } : undefined}
>
  <div class="product-page">
    {error ? (
      <div class="error-container">
        <h1>Product not found</h1>
        <p>{error}</p>
        <a href="/" class="back-link">Back to homepage</a>
      </div>
    ) : (
      <>
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
          <div class="container">
            <a href="/">Home</a>
            <span class="separator"><svg xmlns="http://www.w3.org/2000/svg" width="6" height="12" viewBox="0 0 6 12" fill="none"><path d="M6 6L0.75 11.1962L0.75 0.803848L6 6Z" fill="#469ADC"></path></svg></span>
            {product.categories?.[0] && (
              <>
                <a href={`/collections/${product.categories[0].slug}/`}>{product.categories[0].name}</a>
                <span class="separator"><svg xmlns="http://www.w3.org/2000/svg" width="6" height="12" viewBox="0 0 6 12" fill="none"><path d="M6 6L0.75 11.1962L0.75 0.803848L6 6Z" fill="#469ADC"></path></svg></span>
              </>
            )}
            <span class="current">{product.name}</span>
          </div>
        </nav>

        <!-- Product Section -->
        <section class="product-section">
          <div class="container">
            <div class="product-grid">
              <!-- Left Column: Gallery -->
              <div class="product-gallery">
                <!-- Product Title wrapper - edge-to-edge border like WordPress -->
                <div class="product-title-wrapper">
                  <h1 class="product-title">{product.name}</h1>
                </div>

                <!-- Main Image Container (badges positioned inside) -->
                <div class="main-image-container">
                  <!-- Badges inside image container -->
                  <div class="product-badges">
                    {product.green_product && (
                      <img src="/images/badges/green-option.svg" alt="Eco-friendly" class="badge" />
                    )}
                    {product.made_in_europe && (
                      <img src="/images/badges/made-in-europe.svg" alt="Made in Europe" class="badge" />
                    )}
                  </div>

                  <!-- Gallery Navigation Arrows -->
                  {galleryImages.length > 1 && (
                    <>
                      <button class="gallery-arrow gallery-arrow-prev" id="gallery-prev" aria-label="Previous image">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                      </button>
                      <button class="gallery-arrow gallery-arrow-next" id="gallery-next" aria-label="Next image">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                      </button>
                    </>
                  )}

                  <!-- Main Image - Fast Worker cached image, upgrades to full quality after load -->
                  <div class="main-image">
                  <img
                    id="main-product-image"
                    src={galleryImages[0]?.src || '/images/placeholder.png'}
                    alt={product.name}
                    loading="eager"
                    fetchpriority="high"
                    width="600"
                    height="600"
                    data-full-src={galleryImages[0]?.srcFull}
                    data-upgraded="false"
                  />
                  </div>
                </div>

                <!-- Thumbnails Gallery with Pagination -->
                <!-- Show thumbnails even with 1 image so users see the gallery section -->
                {galleryImages.length >= 1 && (
                  <div class="thumbnail-gallery" id="thumbnail-gallery">
                    <ul class="thumbnail-list">
                      {galleryImages.map((img, index) => (
                        <li class={`thumbnail-item ${index === 0 ? 'active' : ''}`} style={index >= 20 ? 'display: none;' : ''}>
                          <img
                            src={img.thumbnail}
                            alt={img.alt}
                            loading={index === 0 ? 'eager' : 'lazy'}
                            decoding="async"
                            width="100"
                            height="100"
                            data-full-src={img.src}
                            data-full-srcset={img.srcset}
                            data-original-src={img.srcFull}
                            data-index={index}
                          />
                        </li>
                      ))}
                    </ul>
                    <!-- Pagination Controls -->
                    {galleryImages.length > 20 && (
                      <div class="thumbnail-controls">
                        <button class="kd-go-back-btn" id="thumb-back" style="display: none;">Back</button>
                        <button class="kd-show-more-btn" id="thumb-more">Show more</button>
                      </div>
                    )}
                  </div>
                )}
              </div>

              <!-- Right Column: Product Configurator Only -->
              <div class="product-info">
                <!-- Product Configurator (Pearl WC Steps) -->
                <ProductConfigurator
                  productSlug={slug as string}
                  workerUrl={WORKER_URL}
                  client:idle
                />

              </div>
            </div>

            <!-- Product Description Card -->
            <div class="product-description">
              <div class="description-content" set:html={product.description} />
            </div>

          </div>
        </section>

        <!-- How to Get a Design Section - Full Width with Background (WordPress Elementor post-511 style) -->
        <section id="design-section" class="design-section-wrapper">
          <div class="design-section-container">
            <div class="design-header">
              <div class="design-icon">
                <!-- Paint palette icon - white, 50x50 -->
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 39 38" fill="none">
                  <path d="M32.8601 5.89388C29.3052 2.37362 24.503 0.401131 19.5 0.40626H19.3036C14.2737 0.458012 9.46744 2.49249 5.92905 6.06767C2.39065 9.64285 0.405984 14.4699 0.40625 19.5C0.40625 27.3945 5.28617 34.0149 13.1403 36.789C14.0262 37.1014 14.974 37.1967 15.9043 37.0671C16.8346 36.9375 17.7203 36.5868 18.4871 36.0442C19.2539 35.5017 19.8794 34.7832 20.3112 33.949C20.743 33.1149 20.9685 32.1893 20.9687 31.25C20.9687 30.4709 21.2782 29.7238 21.8291 29.1729C22.38 28.622 23.1272 28.3125 23.9062 28.3125H32.3901C33.7228 28.319 35.0176 27.8694 36.0595 27.0385C37.1015 26.2076 37.8279 25.0454 38.1182 23.7447C38.4465 22.2993 38.6061 20.8206 38.5937 19.3384C38.575 16.8296 38.0586 14.3494 37.0744 12.0415C36.0902 9.73367 34.6578 7.64409 32.8601 5.89388ZM35.2468 23.0984C35.101 23.7464 34.7383 24.3252 34.2189 24.7392C33.6995 25.1531 33.0543 25.3774 32.3901 25.375H23.9062C22.3481 25.375 20.8538 25.994 19.752 27.0958C18.6502 28.1975 18.0312 29.6919 18.0312 31.25C18.0306 31.7192 17.9175 32.1814 17.7015 32.598C17.4855 33.0145 17.1729 33.3732 16.7898 33.6441C16.4067 33.915 15.9643 34.0903 15.4996 34.1551C15.0349 34.2199 14.5615 34.1725 14.1189 34.0168C7.47277 31.6723 3.34375 26.1094 3.34375 19.5C3.34352 15.2439 5.02274 11.1596 8.01659 8.13448C11.0104 5.10935 15.077 3.38777 19.3329 3.34376H19.4982C23.7542 3.36029 27.8332 5.04894 30.8556 8.04553C33.878 11.0421 35.6015 15.1066 35.6544 19.3623C35.6653 20.619 35.531 21.8726 35.2542 23.0984H35.2468ZM21.7031 9.95314C21.7031 10.3889 21.5739 10.8148 21.3318 11.1771C21.0897 11.5394 20.7457 11.8218 20.3431 11.9886C19.9405 12.1553 19.4976 12.1989 19.0702 12.1139C18.6428 12.0289 18.2503 11.8191 17.9422 11.511C17.634 11.2029 17.4242 10.8103 17.3392 10.3829C17.2542 9.95558 17.2978 9.5126 17.4646 9.11004C17.6313 8.70747 17.9137 8.36339 18.276 8.1213C18.6383 7.87922 19.0643 7.75001 19.5 7.75001C20.0843 7.75001 20.6447 7.98212 21.0578 8.39529C21.471 8.80846 21.7031 9.36883 21.7031 9.95314ZM13.625 14.3594C13.625 14.7951 13.4958 15.2211 13.2537 15.5834C13.0116 15.9457 12.6675 16.2281 12.265 16.3948C11.8624 16.5616 11.4194 16.6052 10.9921 16.5202C10.5647 16.4352 10.1721 16.2253 9.86403 15.9172C9.55592 15.6091 9.34609 15.2166 9.26108 14.7892C9.17607 14.3618 9.2197 13.9189 9.38645 13.5163C9.5532 13.1137 9.83558 12.7696 10.1979 12.5276C10.5602 12.2855 10.9861 12.1563 11.4219 12.1563C12.0062 12.1563 12.5666 12.3884 12.9797 12.8015C13.3929 13.2147 13.625 13.7751 13.625 14.3594ZM13.625 24.6406C13.625 25.0764 13.4958 25.5023 13.2537 25.8646C13.0116 26.2269 12.6675 26.5093 12.265 26.6761C11.8624 26.8428 11.4194 26.8864 10.9921 26.8014C10.5647 26.7164 10.1721 26.5066 9.86403 26.1985C9.55592 25.8904 9.34609 25.4978 9.26108 25.0704C9.17607 24.6431 9.2197 24.2001 9.38645 23.7975C9.5532 23.395 9.83558 23.0509 10.1979 22.8088C10.5602 22.5667 10.9861 22.4375 11.4219 22.4375C12.0062 22.4375 12.5666 22.6696 12.9797 23.0828C13.3929 23.496 13.625 24.0563 13.625 24.6406ZM29.7812 14.3594C29.7812 14.7951 29.652 15.2211 29.41 15.5834C29.1679 15.9457 28.8238 16.2281 28.4212 16.3948C28.0187 16.5616 27.5757 16.6052 27.1483 16.5202C26.721 16.4352 26.3284 16.2253 26.0203 15.9172C25.7122 15.6091 25.5023 15.2166 25.4173 14.7892C25.3323 14.3618 25.376 13.9189 25.5427 13.5163C25.7095 13.1137 25.9918 12.7696 26.3541 12.5276C26.7164 12.2855 27.1424 12.1563 27.5781 12.1563C28.1624 12.1563 28.7228 12.3884 29.136 12.8015C29.5491 13.2147 29.7812 13.7751 29.7812 14.3594Z" fill="white"></path>
                </svg>
              </div>
              <h2 class="design-title">
                How do I get <span class="highlight">a Design?</span>
              </h2>
              <div class="design-cta-wrapper">
                <ContactFormPopup
                  triggerType="button"
                  triggerText="Request Free Design"
                  client:visible
                />
              </div>
              <p class="design-description">
                We have our own team of graphic designers, each with their own speciality and unique style. This means we can quickly create a design that perfectly matches your needs and vision. Would you rather design it yourself? That's also possible.
              </p>
            </div>

            <div class="design-options">
              <!-- Box 1 - Examples PDF (only shows if pdf_url exists) -->
              {product.pdf_url && (
                <div class="design-option-card">
                  <div class="option-icon">
                    <!-- Wand/magic stick with stars icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="59" height="52" viewBox="0 0 59 52" fill="none"><path d="M4.37229 8.66667C4.37229 8.09203 4.6025 7.54093 5.01229 7.1346C5.42208 6.72827 5.97787 6.5 6.5574 6.5H10.9276V2.16667C10.9276 1.59203 11.1578 1.04093 11.5676 0.634602C11.9774 0.228274 12.5332 0 13.1127 0C13.6922 0 14.248 0.228274 14.6578 0.634602C15.0676 1.04093 15.2978 1.59203 15.2978 2.16667V6.5H19.668C20.2476 6.5 20.8034 6.72827 21.2132 7.1346C21.6229 7.54093 21.8532 8.09203 21.8532 8.66667C21.8532 9.2413 21.6229 9.7924 21.2132 10.1987C20.8034 10.6051 20.2476 10.8333 19.668 10.8333H15.2978V15.1667C15.2978 15.7413 15.0676 16.2924 14.6578 16.6987C14.248 17.1051 13.6922 17.3333 13.1127 17.3333C12.5332 17.3333 11.9774 17.1051 11.5676 16.6987C11.1578 16.2924 10.9276 15.7413 10.9276 15.1667V10.8333H6.5574C5.97787 10.8333 5.42208 10.6051 5.01229 10.1987C4.6025 9.7924 4.37229 9.2413 4.37229 8.66667ZM41.5191 43.3333H39.334V41.1667C39.334 40.592 39.1038 40.0409 38.694 39.6346C38.2842 39.2283 37.7284 39 37.1489 39C36.5694 39 36.0136 39.2283 35.6038 39.6346C35.194 40.0409 34.9638 40.592 34.9638 41.1667V43.3333H32.7787C32.1992 43.3333 31.6434 43.5616 31.2336 43.9679C30.8238 44.3743 30.5936 44.9254 30.5936 45.5C30.5936 46.0746 30.8238 46.6257 31.2336 47.0321C31.6434 47.4384 32.1992 47.6667 32.7787 47.6667H34.9638V49.8333C34.9638 50.408 35.194 50.9591 35.6038 51.3654C36.0136 51.7717 36.5694 52 37.1489 52C37.7284 52 38.2842 51.7717 38.694 51.3654C39.1038 50.9591 39.334 50.408 39.334 49.8333V47.6667H41.5191C42.0987 47.6667 42.6544 47.4384 43.0642 47.0321C43.474 46.6257 43.7042 46.0746 43.7042 45.5C43.7042 44.9254 43.474 44.3743 43.0642 43.9679C42.6544 43.5616 42.0987 43.3333 41.5191 43.3333ZM56.8149 30.3333H52.4447V26C52.4447 25.4254 52.2145 24.8743 51.8047 24.4679C51.3949 24.0616 50.8391 23.8333 50.2596 23.8333C49.68 23.8333 49.1242 24.0616 48.7145 24.4679C48.3047 24.8743 48.0745 25.4254 48.0745 26V30.3333H43.7042C43.1247 30.3333 42.5689 30.5616 42.1591 30.9679C41.7493 31.3743 41.5191 31.9254 41.5191 32.5C41.5191 33.0746 41.7493 33.6257 42.1591 34.0321C42.5689 34.4384 43.1247 34.6667 43.7042 34.6667H48.0745V39C48.0745 39.5746 48.3047 40.1257 48.7145 40.5321C49.1242 40.9384 49.68 41.1667 50.2596 41.1667C50.8391 41.1667 51.3949 40.9384 51.8047 40.5321C52.2145 40.1257 52.4447 39.5746 52.4447 39V34.6667H56.8149C57.3944 34.6667 57.9502 34.4384 58.36 34.0321C58.7698 33.6257 59 33.0746 59 32.5C59 31.9254 58.7698 31.3743 58.36 30.9679C57.9502 30.5616 57.3944 30.3333 56.8149 30.3333ZM51.1637 13L13.1127 50.7298C12.2932 51.5418 11.1821 51.998 10.0235 51.998C8.86497 51.998 7.75382 51.5418 6.93433 50.7298L1.28036 45.129C0.874442 44.7266 0.552445 44.2488 0.332758 43.723C0.113072 43.1972 0 42.6336 0 42.0645C0 41.4953 0.113072 40.9318 0.332758 40.406C0.552445 39.8801 0.874442 39.4024 1.28036 39L39.334 1.27021C39.7398 0.867716 40.2217 0.548437 40.7519 0.330605C41.2822 0.112773 41.8506 0.000655015 42.4246 0.000655015C42.9986 0.000655015 43.5669 0.112773 44.0972 0.330605C44.6275 0.548437 45.1093 0.867716 45.5151 1.27021L51.1637 6.87104C51.5696 7.27344 51.8916 7.75119 52.1113 8.277C52.3309 8.80281 52.444 9.36638 52.444 9.93552C52.444 10.5047 52.3309 11.0682 52.1113 11.594C51.8916 12.1199 51.5696 12.5976 51.1637 13ZM36.2421 21.6667L30.5936 16.0631L4.37229 42.0631L10.0208 47.6667L36.2421 21.6667ZM48.0745 9.93688L42.4232 4.33333L33.6828 13L39.334 18.6035L48.0745 9.93688Z" fill="white"></path></svg>
                  </div>
                  <p class="option-text">Choose up to 4 options from the examples below. Send us your logo, text and colours, and we'll create the designs for you.</p>
                  <a href={product.pdf_url} download class="download-btn">
                    Download Examples
                  </a>
                </div>
              )}

              <!-- Box 2 - Template PDF (only shows if pdf_2_url exists) -->
              {product.pdf_2_url && (
                <div class="design-option-card">
                  <div class="option-icon">
                    <!-- Paint palette icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="54" height="52" viewBox="0 0 54 52" fill="none"><path d="M45.8914 7.77177C40.8646 2.78626 34.074 -0.00724933 26.9995 1.41289e-05H26.7217C19.6093 0.0733075 12.813 2.95461 7.80952 8.01791C2.80605 13.0812 -0.000376428 19.9174 3.78708e-08 27.0413C3.78708e-08 38.2218 6.90046 47.5978 18.0066 51.5266C19.2593 51.9689 20.5995 52.104 21.9151 51.9204C23.2306 51.7369 24.483 51.2401 25.5672 50.4718C26.6515 49.7034 27.536 48.6859 28.1466 47.5045C28.7572 46.3231 29.076 45.0123 29.0764 43.682C29.0764 42.5787 29.514 41.5205 30.293 40.7403C31.072 39.9602 32.1285 39.5218 33.2302 39.5218H45.2268C47.1113 39.531 48.9422 38.8943 50.4156 37.7176C51.8889 36.5409 52.9161 34.8948 53.3267 33.0527C53.7909 31.0057 54.0165 28.9116 53.9991 26.8125C53.9726 23.2593 53.2424 19.7467 51.8506 16.4783C50.4589 13.2098 48.4334 10.2505 45.8914 7.77177ZM49.2664 32.1375C49.0601 33.0552 48.5473 33.8749 47.8128 34.4612C47.0783 35.0474 46.166 35.3651 45.2268 35.3617H33.2302C31.0269 35.3617 28.9138 36.2383 27.3559 37.7986C25.7979 39.359 24.9226 41.4753 24.9226 43.682C24.9217 44.3465 24.7618 45.0011 24.4564 45.591C24.151 46.181 23.7089 46.689 23.1672 47.0727C22.6255 47.4564 21.9999 47.7045 21.3428 47.7963C20.6857 47.8881 20.0162 47.8209 19.3903 47.6004C9.99242 44.2801 4.15377 36.4017 4.15377 27.0413C4.15345 21.0136 6.52795 15.2293 10.7614 10.945C14.9948 6.6607 20.7452 4.22254 26.7633 4.16021H26.9969C33.0152 4.18362 38.7832 6.57514 43.0569 10.819C47.3307 15.0629 49.7678 20.8191 49.8427 26.8463C49.8581 28.6259 49.6682 30.4015 49.2767 32.1375H49.2664ZM30.1149 13.5206C30.1149 14.1377 29.9321 14.741 29.5898 15.2541C29.2475 15.7672 28.761 16.1671 28.1917 16.4033C27.6225 16.6394 26.9961 16.7012 26.3918 16.5808C25.7874 16.4604 25.2323 16.1633 24.7967 15.7269C24.361 15.2906 24.0643 14.7346 23.9441 14.1294C23.8239 13.5241 23.8855 12.8967 24.1213 12.3266C24.3571 11.7565 24.7564 11.2692 25.2687 10.9263C25.7811 10.5835 26.3834 10.4005 26.9995 10.4005C27.8258 10.4005 28.6182 10.7292 29.2024 11.3144C29.7866 11.8995 30.1149 12.6931 30.1149 13.5206ZM18.692 19.7609C18.692 20.378 18.5093 20.9813 18.167 21.4944C17.8246 22.0075 17.3381 22.4074 16.7688 22.6436C16.1996 22.8797 15.5732 22.9415 14.9689 22.8211C14.3646 22.7007 13.8095 22.4036 13.3738 21.9672C12.9381 21.5308 12.6414 20.9749 12.5212 20.3696C12.401 19.7644 12.4627 19.137 12.6985 18.5669C12.9343 17.9968 13.3336 17.5095 13.8459 17.1666C14.3582 16.8238 14.9605 16.6408 15.5767 16.6408C16.4029 16.6408 17.1953 16.9695 17.7795 17.5547C18.3638 18.1398 18.692 18.9334 18.692 19.7609ZM18.692 34.3216C18.692 34.9387 18.5093 35.542 18.167 36.0551C17.8246 36.5682 17.3381 36.9681 16.7688 37.2042C16.1996 37.4404 15.5732 37.5022 14.9689 37.3818C14.3646 37.2614 13.8095 36.9642 13.3738 36.5279C12.9381 36.0915 12.6414 35.5356 12.5212 34.9303C12.401 34.3251 12.4627 33.6977 12.6985 33.1276C12.9343 32.5574 13.3336 32.0701 13.8459 31.7273C14.3582 31.3845 14.9605 31.2015 15.5767 31.2015C16.4029 31.2015 17.1953 31.5302 17.7795 32.1153C18.3638 32.7005 18.692 33.4941 18.692 34.3216ZM41.5377 19.7609C41.5377 20.378 41.355 20.9813 41.0127 21.4944C40.6704 22.0075 40.1838 22.4074 39.6146 22.6436C39.0453 22.8797 38.419 22.9415 37.8146 22.8211C37.2103 22.7007 36.6552 22.4036 36.2195 21.9672C35.7839 21.5308 35.4871 20.9749 35.3669 20.3696C35.2467 19.7644 35.3084 19.137 35.5442 18.5669C35.78 17.9968 36.1793 17.5095 36.6916 17.1666C37.2039 16.8238 37.8063 16.6408 38.4224 16.6408C39.2486 16.6408 40.041 16.9695 40.6253 17.5547C41.2095 18.1398 41.5377 18.9334 41.5377 19.7609Z" fill="white"></path></svg>
                  </div>
                  <p class="option-text">Would you rather create your own design? Download the template below and submit your design. We'll validate the file before production.</p>
                  <a href={product.pdf_2_url} download class="download-btn">
                    Download PDF Templates
                  </a>
                </div>
              )}

              <!-- Box 3 - Contact/Send Design (always shows) -->
              <div class="design-option-card">
                <div class="option-icon">
                  <!-- Pencil/edit icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 52 52" fill="none"><path d="M50.7813 12.8357L39.1623 1.21879C38.776 0.832389 38.3174 0.525877 37.8127 0.316756C37.3079 0.107634 36.7669 0 36.2205 0C35.6742 0 35.1332 0.107634 34.6284 0.316756C34.1237 0.525877 33.665 0.832389 33.2787 1.21879L1.21937 33.2798C0.831416 33.6647 0.523832 34.1228 0.314503 34.6277C0.105173 35.1325 -0.00172488 35.6739 2.10461e-05 36.2204V47.8399C2.10461e-05 48.9432 0.438289 50.0014 1.21841 50.7815C1.99853 51.5617 3.0566 52 4.15986 52H15.7788C16.3253 52.0017 16.8667 51.8948 17.3715 51.6855C17.8763 51.4761 18.3344 51.1685 18.7193 50.7806L40.4727 29.0287L41.3774 32.6428L31.8098 42.2083C31.4195 42.5982 31.2001 43.1272 31.1999 43.679C31.1996 44.2307 31.4186 44.7599 31.8085 45.1502C32.1984 45.5405 32.7274 45.7599 33.2791 45.7601C33.8308 45.7604 34.36 45.5415 34.7503 45.1515L45.1499 34.7514C45.4042 34.4975 45.5885 34.182 45.6846 33.8357C45.7808 33.4894 45.7855 33.1241 45.6985 32.7754L43.9045 25.5967L50.7813 18.7196C51.1677 18.3333 51.4741 17.8746 51.6833 17.3699C51.8924 16.8651 52 16.324 52 15.7777C52 15.2313 51.8924 14.6902 51.6833 14.1855C51.4741 13.6807 51.1677 13.222 50.7813 12.8357ZM4.15986 40.3804L11.619 47.8399H4.15986V40.3804ZM16.6394 46.9793L5.02043 35.3598L27.039 13.3401L38.6579 24.9597L16.6394 46.9793ZM41.5984 22.019L29.9821 10.3995L36.2218 4.15942L47.8382 15.779L41.5984 22.019Z" fill="white"></path></svg>
                </div>
                <p class="option-text">Send us your design or design request</p>
                <div class="contact-btn-wrapper">
                  <ContactFormPopup
                    triggerType="button"
                    triggerText="Contact Form"
                    client:visible
                  />
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- FAQ Section - Card style like product description -->
        {product.faq && product.faq.length > 0 && (
          <section id="faq" class="faq-section">
            <div class="container">
              <div class="faq-card">
                <div class="faq-header">
                  <!-- Stacked layers icon from WordPress -->
                  <svg class="faq-title-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="44" viewBox="0 0 40 44" fill="none">
                    <path d="M39.7673 30.6429C39.9704 31.0031 40.0256 31.4308 39.9207 31.8325C39.8159 32.2342 39.5597 32.577 39.208 32.786L20.7572 43.786C20.5221 43.9262 20.2548 44 19.9826 44C19.7105 44 19.4432 43.9262 19.2081 43.786L0.757253 32.786C0.410712 32.5731 0.160134 32.2294 0.0597732 31.8291C-0.0405878 31.4288 0.0173444 31.0043 0.221027 30.6473C0.424709 30.2904 0.75775 30.0298 1.14804 29.922C1.53834 29.8142 1.95447 29.8678 2.30636 30.0713L19.9884 40.6098L37.6705 30.0713C38.0229 29.8638 38.4414 29.8074 38.8344 29.9145C39.2274 30.0216 39.5629 30.2836 39.7673 30.6429ZM37.6705 20.6427L19.9884 31.1811L2.30636 20.6427C1.95626 20.4645 1.5529 20.4294 1.17837 20.5445C0.803835 20.6596 0.486288 20.9162 0.290356 21.2621C0.0944252 21.608 0.0348365 22.0173 0.123719 22.4065C0.2126 22.7958 0.443273 23.1358 0.768785 23.3573L19.2196 34.3574C19.4547 34.4975 19.722 34.5714 19.9942 34.5714C20.2663 34.5714 20.5336 34.4975 20.7687 34.3574L39.2196 23.3573C39.3968 23.2549 39.5523 23.1174 39.6772 22.953C39.802 22.7886 39.8936 22.6005 39.9467 22.3996C39.9999 22.1987 40.0134 21.9891 39.9866 21.7828C39.9598 21.5765 39.8932 21.3777 39.7906 21.1979C39.688 21.0182 39.5516 20.861 39.3891 20.7356C39.2266 20.6102 39.0414 20.519 38.8441 20.4674C38.6469 20.4157 38.4416 20.4046 38.2401 20.4347C38.0386 20.4648 37.845 20.5355 37.6705 20.6427ZM0 12.5714C0.000613186 12.2961 0.0719491 12.0259 0.206868 11.7877C0.341788 11.5495 0.535558 11.3516 0.768785 11.214L19.2196 0.213952C19.4547 0.0738314 19.722 0 19.9942 0C20.2663 0 20.5336 0.0738314 20.7687 0.213952L39.2196 11.214C39.4517 11.3524 39.6442 11.5506 39.7781 11.7887C39.9119 12.0269 39.9823 12.2967 39.9823 12.5714C39.9823 12.846 39.9119 13.1158 39.7781 13.354C39.6442 13.5921 39.4517 13.7903 39.2196 13.9287L20.7687 24.9288C20.5336 25.0689 20.2663 25.1427 19.9942 25.1427C19.722 25.1427 19.4547 25.0689 19.2196 24.9288L0.768785 13.9287C0.535558 13.7911 0.341788 13.5933 0.206868 13.3551C0.0719491 13.1168 0.000613186 12.8466 0 12.5714ZM4.58965 12.5714L19.9884 21.7525L35.3872 12.5714L19.9884 3.39022L4.58965 12.5714Z" fill="#253461"/>
                  </svg>
                  <h2 class="faq-title">Frequently Asked <span class="highlight">Questions</span></h2>
                </div>
                <div class="faq-accordion">
                  {product.faq.map((item: { question: string; answer: string }, index: number) => (
                    <div class="faq-item" data-faq-index={index}>
                      <button class="faq-question" aria-expanded="false">
                        <span>{item.question}</span>
                        <!-- Plus icon (collapsed state) -->
                        <svg class="faq-icon faq-icon-plus" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none">
                          <path d="M15.7143 14.2857H20.7143C21.1088 14.2857 21.4286 14.6055 21.4286 15C21.4286 15.3945 21.1088 15.7143 20.7143 15.7143H15.7143V20.7143C15.7143 21.1088 15.3945 21.4286 15 21.4286C14.6055 21.4286 14.2857 21.1088 14.2857 20.7143V15.7143H9.28571C8.89123 15.7143 8.57143 15.3945 8.57143 15C8.57143 14.6055 8.89123 14.2857 9.28571 14.2857H14.2857V9.28571C14.2857 8.89123 14.6055 8.57143 15 8.57143C15.3945 8.57143 15.7143 8.89123 15.7143 9.28571V14.2857ZM15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0C23.2843 0 30 6.71573 30 15C30 23.2843 23.2843 30 15 30ZM15 28.5714C22.4953 28.5714 28.5714 22.4953 28.5714 15C28.5714 7.50471 22.4953 1.42857 15 1.42857C7.50471 1.42857 1.42857 7.50471 1.42857 15C1.42857 22.4953 7.50471 28.5714 15 28.5714Z" fill="#469ADC"/>
                        </svg>
                        <!-- Minus icon (expanded state) -->
                        <svg class="faq-icon faq-icon-minus" xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none">
                          <path d="M20.7143 14.2857C21.1088 14.2857 21.4286 14.6055 21.4286 15C21.4286 15.3945 21.1088 15.7143 20.7143 15.7143H9.28571C8.89123 15.7143 8.57143 15.3945 8.57143 15C8.57143 14.6055 8.89123 14.2857 9.28571 14.2857H20.7143ZM15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0C23.2843 0 30 6.71573 30 15C30 23.2843 23.2843 30 15 30ZM15 28.5714C22.4953 28.5714 28.5714 22.4953 28.5714 15C28.5714 7.50471 22.4953 1.42857 15 1.42857C7.50471 1.42857 1.42857 7.50471 1.42857 15C1.42857 22.4953 7.50471 28.5714 15 28.5714Z" fill="#469ADC"/>
                        </svg>
                      </button>
                      <div class="faq-answer">
                        <div class="faq-answer-content" set:html={item.answer}></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </section>
        )}

        <!-- Related Products Section - "Other customers also liked these products" -->
        {relatedProducts.length > 0 && (
          <section class="related-products-section">
            <div class="related-products-container">
              <h2 class="related-heading">
                Other customers also liked <span class="highlight">these products</span>
              </h2>
              <ul class="related-products">
                {relatedProducts.map((relProduct: any) => (
                  <li class="related-product-item">
                    <a href={`/products/${relProduct.slug}`} class="related-product-link">
                      <img
                        src={`https://hercules-product-sync-uk.gilles-86d.workers.dev/image/${relProduct.slug}/0`}
                        alt={relProduct.name}
                        loading="lazy"
                        decoding="async"
                        width="361"
                        height="361"
                      />
                      <h3 class="related-product-title">{relProduct.name}</h3>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </section>
        )}

        <!-- Customer Reviews Section - "What Customers Say About Us" -->
        <section class="reviews-section">
          <div class="container">
            <h2 class="reviews-heading">
              What Customers <span class="highlight">Say About Us</span>
            </h2>
            <!-- TrustIndex Widget - Same widget ID as WordPress, logo replaced with Google -->
            <div class="reviews-widget" id="trustindex-widget-product"></div>
          </div>
        </section>

        <!-- Lightbox Modal -->
        <div id="lightbox" class="lightbox" aria-hidden="true">
          <div class="lightbox-backdrop"></div>
          <div class="lightbox-content">
            <button class="lightbox-close" aria-label="Close">&times;</button>
            <button class="lightbox-nav lightbox-prev" aria-label="Previous image">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <div class="lightbox-image-container">
              <img id="lightbox-image" src="" alt="" />
            </div>
            <button class="lightbox-nav lightbox-next" aria-label="Next image">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
            <div class="lightbox-counter">
              <span id="lightbox-current">1</span> / <span id="lightbox-total">{galleryImages.length}</span>
            </div>
          </div>
        </div>
      </>
    )}
  </div>
</BaseLayout>

<style>
  .product-page {
    background: #FAFAFA;
    min-height: 100vh;
  }

  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0;
  }

  .error-container {
    text-align: center;
    padding: 100px 20px;
  }

  .error-container h1 {
    color: #253461;
    margin-bottom: 15px;
  }

  .back-link {
    display: inline-block;
    margin-top: 20px;
    padding: 12px 30px;
    background: #469ADC;
    color: white;
    text-decoration: none;
    border-radius: 50px;
  }

  /* Breadcrumb - Matching WordPress EAEL styling */
  .breadcrumb {
    background: #FAFAFA;
    padding: 28px 0 5px;
  }

  .breadcrumb .container {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: 'Jost', sans-serif;
    font-size: 14px;
    font-weight: 400;
  }

  .breadcrumb a {
    color: rgb(95, 95, 95);
    font-size: 14px;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .breadcrumb a:hover {
    color: #469ADC;
  }

  .breadcrumb .separator {
    display: inline-flex;
    align-items: center;
    margin: 0 2px;
  }

  .breadcrumb .separator svg {
    width: 6px;
    height: 12px;
  }

  .breadcrumb .current {
    color: #469ADC;
  }

  /* Product Section */
  .product-section {
    padding: 20px 0;
  }

  .product-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    align-items: start; /* Prevent columns from stretching to match each other */
  }

  @media (max-width: 900px) {
    .container {
      padding: 0 15px;
    }
    .product-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }
  }

  /* Gallery - WordPress kd-white-container style */
  .product-gallery {
    min-width: 0; /* Prevent grid blowout from thumbnail gallery */
    max-width: 100%;
    overflow: hidden;
    background: white;
    padding: 20px;
    border-radius: 20px;
    border: 1px solid #DCDCDC;
    align-self: start; /* Don't stretch to match right column height */
    height: fit-content; /* Force content-based height */
  }

  /* Main image container - holds image and badges */
  .main-image-container {
    position: relative;
  }

  .product-badges {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .product-badges .badge {
    width: 60px;
    height: auto;
  }

  .main-image {
    background: transparent;
    border-radius: 15px;
    overflow: hidden;
    width: 100%;
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .main-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  /* Gallery Navigation Arrows */
  .gallery-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 15;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #dcdcdc;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: #253461;
  }

  .gallery-arrow:hover {
    background-color: #253461;
    color: white;
    border-color: #253461;
  }

  .gallery-arrow-prev {
    left: 10px;
  }

  .gallery-arrow-next {
    right: 10px;
  }

  .gallery-arrow svg {
    width: 20px;
    height: 20px;
  }

  @media (max-width: 768px) {
    .gallery-arrow {
      width: 32px;
      height: 32px;
    }

    .gallery-arrow svg {
      width: 16px;
      height: 16px;
    }

    .gallery-arrow-prev {
      left: 5px;
    }

    .gallery-arrow-next {
      right: 5px;
    }
  }

  /* Thumbnail Gallery - WordPress/WooCommerce style */
  .thumbnail-gallery {
    margin-top: 1em;
    padding-top: 1em;
    overflow: hidden;
    max-width: 100%;
  }

  .thumbnail-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 10px;
  }

  .thumbnail-item {
    width: calc(18.5% - 8px);
    float: left;
    margin: 0;
    padding: 5px;
    list-style: none;
    background: #e6e6e6;
    border-radius: 15px;
    box-sizing: border-box;
  }

  .thumbnail-item img {
    width: 94px;
    height: 94px;
    display: block;
    margin: 0;
    cursor: pointer;
    filter: blur(1px);
    opacity: 0.7;
    transition: filter 0.2s, opacity 0.2s;
    object-fit: cover;
    border-radius: 10px;
  }

  .thumbnail-item:hover img,
  .thumbnail-item.active img {
    filter: blur(0);
    opacity: 1;
  }

  /* Active thumbnail border - WordPress kd-active style */
  .thumbnail-item.active {
    border: 2px solid #469ADC;
  }

  /* Mobile responsive - 4 thumbnails per row filling full width */
  @media only screen and (max-width: 768px) {
    .thumbnail-item {
      width: calc(25% - 7.5px);
    }

    .thumbnail-item img {
      width: 100%;
      height: auto;
    }
  }

  /* Pagination Controls - WordPress style */
  .thumbnail-controls {
    margin-top: 10px;
    overflow: hidden;
  }

  .thumbnail-controls::after {
    content: "";
    display: table;
    clear: both;
  }

  .kd-show-more-btn,
  .kd-go-back-btn {
    margin: 10px;
    color: #253461;
    padding: 0;
    border: none;
    font-family: 'Jost', sans-serif;
    font-size: 18px;
    font-weight: 600;
    background: transparent;
    cursor: pointer;
    transition: color 0.2s;
  }

  .kd-show-more-btn {
    float: right;
  }

  .kd-go-back-btn {
    float: left;
  }

  .kd-show-more-btn:hover,
  .kd-go-back-btn:hover,
  .kd-show-more-btn:focus,
  .kd-go-back-btn:focus {
    color: #469ADC;
    background: transparent;
  }

  /* Product Info - Right column for configurator only */
  .product-info {
    display: flex;
    flex-direction: column;
    gap: 20px;
    min-width: 0; /* Prevent grid blowout */
    height: fit-content;
    min-height: 500px; /* Reserve space to prevent CLS during hydration */
  }

  /* Product Title Wrapper - Edge-to-edge border like WordPress */
  .product-title-wrapper {
    margin: -20px -20px 20px -20px; /* Extend to gallery edges */
    padding: 20px 24px 15px 25px; /* WordPress exact padding */
    border-bottom: 1px solid #DCDCDC;
  }

  /* Product Title - Inside gallery box */
  .product-title {
    font-family: 'Jost', sans-serif;
    font-size: 15px;
    font-weight: 500;
    line-height: 15px;
    color: #253461;
    margin: 0;
    text-transform: uppercase;
  }

  @media (max-width: 768px) {
    .product-title-wrapper {
      margin: -20px -20px 15px -20px; /* Match gallery padding on mobile too */
      padding: 15px 20px 12px 20px;
    }
    .product-title {
      font-size: 14px;
      line-height: 14px;
    }
  }

  /* ProductConfigurator component handles variations and add-to-cart via steps.css */

  /* Product Description Card - Matching WordPress Elementor */
  .product-description {
    margin-top: 50px;
    border: 1px solid #DCDCDC;
    border-radius: 20px;
    background-color: white;
    padding: 40px 30px;
  }

  .description-content {
    font-family: 'Jost', sans-serif;
    font-size: 16px;
    line-height: 1.5;
    color: #5F5F5F;
  }

  /* Styles for injected HTML content (set:html) - must use :global() */
  /* Main title in description - WordPress style (first h2 only) */
  .description-content :global(h2:first-of-type) {
    font-family: 'Jost', sans-serif;
    font-size: 45px;
    font-weight: 600;
    text-transform: uppercase;
    color: #253461;
    text-align: center;
    margin: 0 0 30px 0;
    line-height: 1.2;
  }

  /* Other headings in description (not the main title) */
  .description-content :global(h2 ~ h2),
  .description-content :global(h3) {
    font-family: 'Jost', sans-serif;
    color: #253461;
    margin: 30px 0 15px 0;
    font-size: 22px;
    font-weight: 600;
    text-align: left;
    text-transform: none;
  }

  .description-content :global(h4) {
    font-family: 'Jost', sans-serif;
    color: #253461;
    margin: 25px 0 12px 0;
    font-size: 18px;
    font-weight: 600;
  }

  .description-content :global(p) {
    margin-bottom: 18px;
  }

  /* Bullet point list styling - WordPress style */
  .description-content :global(ul) {
    list-style: none;
    padding-left: 40px;
    margin: 20px 0;
  }

  .description-content :global(ul li) {
    position: relative;
    padding-left: 25px;
    line-height: 1.6;
  }

  .description-content :global(ul li::before) {
    content: '';
    position: absolute;
    left: 0;
    top: 8px;
    width: 8px;
    height: 8px;
    background-color: #5F5F5F;
    border-radius: 50%;
  }

  /* Ordered list styling */
  .description-content :global(ol) {
    list-style-type: decimal;
    padding-left: 40px;
    margin: 20px 0;
  }

  .description-content :global(ol li) {
    line-height: 1.6;
    padding-left: 5px;
  }

  .description-content :global(a) {
    color: #469ADC;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .description-content :global(a:hover) {
    color: #253461;
    text-decoration: underline;
  }

  .description-content :global(strong) {
    font-weight: 600;
  }

  @media (max-width: 768px) {
    .product-description {
      padding: 30px 20px;
    }

    .description-content {
      font-size: 15px;
    }

    .description-content :global(h2:first-of-type) {
      font-size: 28px;
    }

    .description-content :global(h2 ~ h2),
    .description-content :global(h3) {
      font-size: 18px;
    }

    .description-content :global(ul li) {
      padding-left: 22px;
    }

    .description-content :global(ul li::before) {
      width: 6px;
      height: 6px;
      top: 7px;
    }
  }

  /* Design Section - "How do I get a Design?" - WordPress Elementor post-511 style */
  .design-section-wrapper {
    margin-top: 35px;
    background: url('/images/footer-bg-1.jpg') center center / cover no-repeat;
    position: relative;
    padding: 40px 20px 35px 20px;
  }

  .design-section-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0;
    position: relative;
    z-index: 1;
  }

  .design-header {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .design-icon {
    margin: 0 5px 0 6%;
    display: flex;
    align-items: center;
  }

  .design-title {
    font-family: 'Jost', sans-serif;
    font-size: 45px;
    font-weight: 600;
    text-transform: uppercase;
    color: #ffffff;
    margin: 0;
    line-height: 1.2;
  }

  .design-title .highlight {
    color: #469ADC;
  }

  .design-cta-wrapper {
    align-self: flex-end;
    margin: 0;
  }

  .design-cta-wrapper :global(button) {
    display: inline-block;
    background-color: #10C99E !important;
    color: white !important;
    font-family: 'Jost', sans-serif !important;
    font-size: 15px !important;
    font-weight: 500 !important;
    text-transform: uppercase !important;
    padding: 14px 25px !important;
    border-radius: 100px !important;
    border: 1px solid #10C99E !important;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .design-cta-wrapper :global(button:hover) {
    background-color: transparent !important;
    color: #10C99E !important;
    border-color: #10C99E !important;
  }

  .design-description {
    width: 100%;
    max-width: 765px;
    text-align: center;
    font-family: 'Jost', sans-serif;
    font-size: 18px;
    font-weight: 400;
    line-height: 1.6;
    color: #ffffff;
    margin: 20px auto 0 auto;
  }

  .design-options {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
    margin-top: 20px;
  }

  .design-option-card {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    border: 1px solid #469ADC;
    padding: 46px;
    text-align: center;
  }

  .option-icon {
    margin-bottom: 15px;
    text-align: center;
  }

  /* Text inside the boxes - WordPress Elementor style (Roboto 17px white) */
  .option-text {
    font-family: 'Roboto', sans-serif;
    font-size: 17px;
    font-weight: 400;
    line-height: 1.6;
    color: #ffffff;
    margin: 0 0 20px 0;
    flex-grow: 1;
    text-align: center;
  }

  .download-btn {
    display: inline-block;
    background-color: #10C99E;
    color: white;
    font-family: 'Jost', sans-serif;
    font-size: 15px;
    font-weight: 500;
    text-transform: uppercase;
    padding: 13px 25px;
    border-radius: 100px;
    border: 1px solid #10C99E;
    text-decoration: none;
    transition: all 0.3s ease;
    margin-top: auto;
  }

  .download-btn:hover {
    background-color: transparent;
    color: #10C99E;
    border-color: #10C99E;
  }

  /* Contact button wrapper in Box 3 */
  .contact-btn-wrapper {
    margin-top: auto;
  }

  .contact-btn-wrapper :global(button) {
    display: inline-block;
    background-color: #10C99E !important;
    color: white !important;
    font-family: 'Jost', sans-serif !important;
    font-size: 15px !important;
    font-weight: 500 !important;
    text-transform: uppercase !important;
    padding: 13px 25px !important;
    border-radius: 100px !important;
    border: 1px solid #10C99E !important;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .contact-btn-wrapper :global(button:hover) {
    background-color: transparent !important;
    color: #10C99E !important;
    border-color: #10C99E !important;
  }

  @media (max-width: 992px) {
    .design-options {
      flex-direction: column;
      gap: 20px;
    }

    .design-header {
      flex-direction: column;
      text-align: center;
    }

    .design-icon {
      margin: 0 0 15px 0;
    }

    .design-cta-wrapper {
      align-self: center;
      margin-top: 20px;
    }
  }

  @media (max-width: 768px) {
    .design-section-wrapper {
      padding: 30px 15px;
    }

    .design-title {
      font-size: 28px;
    }

    .design-option-card {
      padding: 30px 20px;
    }

    .design-option-card {
      padding: 25px 20px;
    }
  }

  /* Lightbox */
  .lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .lightbox.active {
    opacity: 1;
    visibility: visible;
  }

  .lightbox-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
  }

  .lightbox-content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-image-container {
    max-width: 90%;
    max-height: 90%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-image-container img {
    max-width: 100%;
    max-height: 85vh;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
  }

  .lightbox-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 32px;
    cursor: pointer;
    transition: background 0.2s, transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  .lightbox-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }

  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    transition: background 0.2s, transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  .lightbox-nav:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-50%) scale(1.1);
  }

  .lightbox-prev {
    left: 20px;
  }

  .lightbox-next {
    right: 20px;
  }

  .lightbox-counter {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    background: rgba(0, 0, 0, 0.5);
    padding: 8px 20px;
    border-radius: 20px;
  }

  /* Make main image clickable */
  .main-image {
    cursor: zoom-in;
  }

  @media (max-width: 768px) {
    .lightbox-nav {
      width: 40px;
      height: 40px;
    }

    .lightbox-prev {
      left: 10px;
    }

    .lightbox-next {
      right: 10px;
    }

    .lightbox-close {
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      font-size: 24px;
    }
  }

  /* FAQ Section Styles - Card style matching product description */
  .faq-section {
    padding: 30px 0;
    background: #ffffff;
  }

  .faq-card {
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    padding: 30px;
  }

  .faq-header {
    display: flex;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid #e0e0e0;
    position: relative;
  }

  .faq-title-icon {
    flex-shrink: 0;
    position: absolute;
    left: 0;
  }

  .faq-title {
    font-family: 'Jost', sans-serif;
    font-size: 35px;
    font-weight: 600;
    text-transform: uppercase;
    color: #253461;
    margin: 0;
    text-align: center;
    width: 100%;
  }

  .faq-title .highlight {
    color: #469ADC;
  }

  .faq-accordion {
    width: 100%;
  }

  .faq-item {
    border-bottom: 1px solid #e0e0e0;
  }

  .faq-item:last-child {
    border-bottom: none;
  }

  .faq-question {
    width: 100%;
    padding: 18px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
    font-family: 'Jost', sans-serif;
    font-size: 25px;
    font-weight: 400;
    color: #253461;
  }

  .faq-question:hover {
    color: #253461;
  }

  .faq-question span {
    flex: 1;
    padding-right: 15px;
  }

  /* Plus/Minus icon toggle */
  .faq-icon {
    flex-shrink: 0;
  }

  .faq-icon-minus {
    display: none;
  }

  .faq-item.active .faq-icon-plus {
    display: none;
  }

  .faq-item.active .faq-icon-minus {
    display: block;
  }

  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .faq-item.active .faq-answer {
    max-height: 500px;
  }

  .faq-answer-content {
    padding: 0 0 20px 0;
    font-family: 'Roboto', sans-serif;
    font-size: 15px;
    line-height: 1.7;
    color: #5f5f5f;
  }

  .faq-answer-content p {
    margin: 0 0 15px 0;
  }

  .faq-answer-content p:last-child {
    margin-bottom: 0;
  }

  @media (max-width: 768px) {
    .faq-section {
      padding: 30px 0;
    }

    .faq-card {
      padding: 20px;
    }

    .faq-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    .faq-title-icon {
      position: static;
    }

    .faq-title {
      font-size: 24px;
      text-align: left;
    }

    .faq-question {
      font-size: 15px;
      padding: 15px 0;
    }

    .faq-answer-content {
      font-size: 14px;
    }
  }

  /* Related Products Section - "Other customers also liked these products" - Matching WordPress */
  .related-products-section {
    padding: 60px 0;
    background: #F4F4F4;
    width: 100%;
  }

  .related-products-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0;
  }

  .related-heading {
    font-family: 'Jost', sans-serif;
    font-size: 35px;
    font-weight: 600;
    color: #253461;
    text-align: center;
    margin: 0 0 40px 0;
    text-transform: uppercase;
  }

  .related-heading .highlight {
    color: #469ADC;
  }

  /* Grid: 5 columns, 20px column gap, 40px row gap */
  .related-products {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-column-gap: 20px;
    grid-row-gap: 40px;
    margin: 0;
    padding: 0;
    list-style: none;
    width: 100%;
  }

  .related-product-item {
    background: #fff;
    text-align: center;
    border: 1px solid #DCDCDC;
    border-radius: 20px;
    padding: 40px 15px;
    box-sizing: border-box;
  }

  .related-product-link {
    text-decoration: none;
    display: block;
  }

  .related-product-link img {
    width: 100%;
    height: auto;
    aspect-ratio: 1;
    object-fit: contain;
    display: block;
    border-radius: 10px;
  }

  .related-product-title {
    font-family: 'Jost', sans-serif;
    font-size: 18px;
    font-weight: 500;
    color: #253461;
    margin: 15px 0 0 0;
    padding: 0;
    line-height: 1.3;
    text-align: center;
    text-transform: uppercase;
  }

  .related-product-link:hover .related-product-title {
    color: #469ADC;
  }

  /* Tablet: 4 columns */
  @media (max-width: 1024px) {
    .related-products-section {
      padding: 40px 0;
    }

    .related-products {
      grid-template-columns: repeat(4, 1fr);
    }

    .related-heading {
      font-size: 28px;
    }
  }

  /* Mobile: 2 columns */
  @media (max-width: 768px) {
    .related-products-section {
      padding: 40px 0;
    }

    .related-products {
      grid-template-columns: repeat(2, 1fr);
      grid-column-gap: 15px;
      grid-row-gap: 20px;
    }

    .related-product-item {
      padding: 20px 10px;
    }

    .related-heading {
      font-size: 22px;
      margin-bottom: 25px;
    }

    .related-product-title {
      font-size: 14px;
    }
  }

  /* Small mobile: 1 column */
  @media (max-width: 480px) {
    .related-products {
      grid-template-columns: 1fr;
    }
  }

  /* Below-fold sections - defer rendering until near viewport */
  .design-section-wrapper,
  .faq-section,
  .related-products-section,
  .reviews-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 400px;
  }

  /* Customer Reviews Section - "What Customers Say About Us" - Matching homepage spacing */
  .reviews-section {
    width: 100%;
    max-width: 1280px;
    margin: 0 auto;
    padding: 80px 0 50px 0;
  }

  .reviews-heading {
    font-family: 'Jost', sans-serif;
    font-size: 35px;
    font-weight: 600;
    text-transform: uppercase;
    color: #253461;
    text-align: center;
    margin: 0 0 55px 0;
  }

  .reviews-heading .highlight {
    color: #469ADC;
  }

  .reviews-widget {
    width: 100%;
    min-height: 300px;
  }

  @media (max-width: 1024px) {
    .reviews-heading {
      font-size: 30px;
    }
  }

  @media (max-width: 767px) {
    .reviews-section {
      padding: 40px 20px;
    }

    .reviews-heading {
      font-size: 28px;
    }
  }
</style>

<script>
  // Progressive Image Upgrade - Load high-quality image after page load
  // This ensures fast LCP with cached 361px image, then upgrades to full quality
  function upgradeMainImage() {
    const mainImg = document.getElementById('main-product-image') as HTMLImageElement;
    if (!mainImg || mainImg.dataset.upgraded === 'true') return;

    const fullSrc = mainImg.dataset.fullSrc;
    if (!fullSrc || fullSrc === mainImg.src) return;

    // Preload the high-quality image
    const highQualityImg = new Image();
    highQualityImg.onload = () => {
      // Swap to high-quality image once loaded
      mainImg.src = fullSrc;
      mainImg.dataset.upgraded = 'true';
    };
    highQualityImg.src = fullSrc;
  }

  // Upgrade after page is fully loaded (after LCP is measured)
  if (document.readyState === 'complete') {
    setTimeout(upgradeMainImage, 100);
  } else {
    window.addEventListener('load', () => setTimeout(upgradeMainImage, 100));
  }

  // Thumbnail Gallery Pagination (WordPress style)
  const PAGE_SIZE = 20;
  let currentPage = 0;
  const thumbnailItems = document.querySelectorAll('.thumbnail-item');
  const totalThumbnails = thumbnailItems.length;
  const showMoreBtn = document.getElementById('thumb-more');
  const goBackBtn = document.getElementById('thumb-back');

  function showPage(page: number) {
    const start = page * PAGE_SIZE;
    const end = Math.min(start + PAGE_SIZE, totalThumbnails);

    thumbnailItems.forEach((item, index) => {
      const li = item as HTMLElement;
      if (index >= start && index < end) {
        li.style.display = 'inline-block';
        // Lazy load images on this page
        const img = li.querySelector('img');
        if (img && img.loading === 'lazy') {
          img.loading = 'eager';
        }
      } else {
        li.style.display = 'none';
      }
    });
  }

  function updateControls() {
    if (!showMoreBtn || !goBackBtn) return;

    const end = Math.min((currentPage + 1) * PAGE_SIZE, totalThumbnails);
    const hasMorePages = end < totalThumbnails;
    const hasPreviousPages = currentPage > 0;

    showMoreBtn.style.display = hasMorePages ? 'inline-block' : 'none';
    goBackBtn.style.display = hasPreviousPages ? 'inline-block' : 'none';
  }

  // Initialize pagination
  if (totalThumbnails > PAGE_SIZE) {
    showPage(0);
    updateControls();

    if (showMoreBtn) {
      showMoreBtn.addEventListener('click', () => {
        if ((currentPage + 1) * PAGE_SIZE < totalThumbnails) {
          currentPage++;
          showPage(currentPage);
          updateControls();
        }
      });
    }

    if (goBackBtn) {
      goBackBtn.addEventListener('click', () => {
        if (currentPage > 0) {
          currentPage--;
          showPage(currentPage);
          updateControls();
        }
      });
    }
  }

  // Gallery images data for lightbox
  const galleryImages: { src: string; alt: string }[] = [];
  document.querySelectorAll('.thumbnail-item img').forEach(img => {
    const imgEl = img as HTMLImageElement;
    const fullSrc = imgEl.dataset.fullSrc;
    if (fullSrc) {
      galleryImages.push({
        src: fullSrc,
        alt: imgEl.alt || ''
      });
    }
  });

  // If no thumbnails, get from main image
  if (galleryImages.length === 0) {
    const mainImg = document.getElementById('main-product-image') as HTMLImageElement;
    if (mainImg) {
      galleryImages.push({
        src: mainImg.src,
        alt: mainImg.alt
      });
    }
  }

  let currentLightboxIndex = 0;

  // Lightbox elements
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
  const lightboxCurrent = document.getElementById('lightbox-current');
  const lightboxClose = document.querySelector('.lightbox-close');
  const lightboxBackdrop = document.querySelector('.lightbox-backdrop');
  const lightboxPrev = document.querySelector('.lightbox-prev');
  const lightboxNext = document.querySelector('.lightbox-next');

  // Open lightbox
  function openLightbox(index: number) {
    if (!lightbox || !lightboxImage || galleryImages.length === 0) return;

    currentLightboxIndex = index;
    updateLightboxImage();
    lightbox.classList.add('active');
    lightbox.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }

  // Close lightbox
  function closeLightbox() {
    if (!lightbox) return;

    lightbox.classList.remove('active');
    lightbox.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }

  // Update lightbox image
  function updateLightboxImage() {
    if (!lightboxImage || !lightboxCurrent) return;

    const image = galleryImages[currentLightboxIndex];
    lightboxImage.src = image.src;
    lightboxImage.alt = image.alt;
    lightboxCurrent.textContent = String(currentLightboxIndex + 1);
  }

  // Navigate lightbox
  function navigateLightbox(direction: number) {
    currentLightboxIndex += direction;

    // Loop around
    if (currentLightboxIndex < 0) {
      currentLightboxIndex = galleryImages.length - 1;
    } else if (currentLightboxIndex >= galleryImages.length) {
      currentLightboxIndex = 0;
    }

    updateLightboxImage();
  }

  // Main image click opens lightbox
  const mainImageContainer = document.querySelector('.main-image');
  if (mainImageContainer) {
    mainImageContainer.addEventListener('click', () => {
      // Find current active thumbnail index
      const activeItem = document.querySelector('.thumbnail-item.active img');
      const index = activeItem ? parseInt((activeItem as HTMLElement).dataset.index || '0') : 0;
      openLightbox(index);
    });
  }

  // Thumbnail gallery interaction - click on li or img to swap main image
  // Uses progressive enhancement: show Worker image fast, then upgrade to WordPress
  document.querySelectorAll('.thumbnail-item').forEach(item => {
    item.addEventListener('click', () => {
      const mainImg = document.getElementById('main-product-image') as HTMLImageElement;
      const img = item.querySelector('img') as HTMLImageElement;
      const workerSrc = img?.dataset.fullSrc;      // Worker cached 361px (fast)
      const originalSrc = img?.dataset.originalSrc; // WordPress full quality

      if (mainImg && workerSrc) {
        // Step 1: Immediately show Worker cached image (fast swap)
        mainImg.src = workerSrc;
        mainImg.dataset.fullSrc = originalSrc || workerSrc;
        mainImg.dataset.upgraded = 'false';

        // Step 2: Upgrade to high-quality WordPress image in background
        if (originalSrc && originalSrc !== workerSrc) {
          const highQualityImg = new Image();
          highQualityImg.onload = () => {
            mainImg.src = originalSrc;
            mainImg.dataset.upgraded = 'true';
          };
          highQualityImg.src = originalSrc;
        }

        // Update active state on li elements
        document.querySelectorAll('.thumbnail-item').forEach(t => t.classList.remove('active'));
        item.classList.add('active');
      }
    });

    // Double-click thumbnail opens lightbox at that image
    item.addEventListener('dblclick', () => {
      const img = item.querySelector('img') as HTMLImageElement;
      const index = parseInt(img?.dataset.index || '0');
      openLightbox(index);
    });
  });

  // Gallery Arrow Navigation
  const galleryPrevBtn = document.getElementById('gallery-prev');
  const galleryNextBtn = document.getElementById('gallery-next');
  const allThumbnails = document.querySelectorAll('.thumbnail-item');

  function getCurrentGalleryIndex(): number {
    const activeItem = document.querySelector('.thumbnail-item.active img') as HTMLImageElement;
    return activeItem ? parseInt(activeItem.dataset.index || '0') : 0;
  }

  function navigateGallery(direction: number) {
    const currentIndex = getCurrentGalleryIndex();
    let newIndex = currentIndex + direction;

    // Loop around
    if (newIndex < 0) {
      newIndex = allThumbnails.length - 1;
    } else if (newIndex >= allThumbnails.length) {
      newIndex = 0;
    }

    // Click the thumbnail at the new index to trigger image swap
    const targetThumbnail = allThumbnails[newIndex] as HTMLElement;
    if (targetThumbnail) {
      targetThumbnail.click();
    }
  }

  if (galleryPrevBtn) {
    galleryPrevBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent lightbox from opening
      navigateGallery(-1);
    });
  }

  if (galleryNextBtn) {
    galleryNextBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent lightbox from opening
      navigateGallery(1);
    });
  }

  // Lightbox controls
  if (lightboxClose) {
    lightboxClose.addEventListener('click', closeLightbox);
  }

  if (lightboxBackdrop) {
    lightboxBackdrop.addEventListener('click', closeLightbox);
  }

  if (lightboxPrev) {
    lightboxPrev.addEventListener('click', () => navigateLightbox(-1));
  }

  if (lightboxNext) {
    lightboxNext.addEventListener('click', () => navigateLightbox(1));
  }

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;

    switch (e.key) {
      case 'Escape':
        closeLightbox();
        break;
      case 'ArrowLeft':
        navigateLightbox(-1);
        break;
      case 'ArrowRight':
        navigateLightbox(1);
        break;
    }
  });

  // Product configurator handles all quantity and add-to-cart functionality via React component

  // FAQ Accordion toggle
  const faqItems = document.querySelectorAll('.faq-item');
  faqItems.forEach(item => {
    const question = item.querySelector('.faq-question');
    if (question) {
      question.addEventListener('click', () => {
        // Close other open items
        faqItems.forEach(other => {
          if (other !== item && other.classList.contains('active')) {
            other.classList.remove('active');
            const btn = other.querySelector('.faq-question');
            if (btn) btn.setAttribute('aria-expanded', 'false');
          }
        });
        // Toggle current item
        item.classList.toggle('active');
        const isActive = item.classList.contains('active');
        question.setAttribute('aria-expanded', isActive ? 'true' : 'false');
      });
    }
  });

  // Load TrustIndex widget only when visible (with Google logo replacement)
  const trustIndexContainer = document.getElementById('trustindex-widget-product');
  if (trustIndexContainer) {
    const loadTrustWidget = () => {
      const script = document.createElement('script');
      script.src = 'https://cdn.trustindex.io/loader.js?cb5ae3e497fe7730a8269155c1e';
      script.defer = true;
      script.async = true;
      trustIndexContainer.appendChild(script);

      // Replace TrustIndex logo with Google logo after widget loads
      script.onload = function() {
        setTimeout(replaceTrustIndexLogo, 1000);
        setTimeout(replaceTrustIndexLogo, 2000);
        setTimeout(replaceTrustIndexLogo, 3000);
      };
    };

    function replaceTrustIndexLogo() {
      // Only target the TrustIndex logo image (not other elements)
      var logoImages = document.querySelectorAll('.ti-widget img');
      logoImages.forEach(function(img) {
        // Only replace if it's the TrustIndex logo (check src contains trustindex)
        if (img.src && img.src.includes('trustindex') && img.src.includes('logo')) {
          var googleLogo = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          googleLogo.setAttribute('viewBox', '0 0 272 92');
          googleLogo.setAttribute('width', img.width || '80');
          googleLogo.setAttribute('height', img.height || '28');
          googleLogo.style.cssText = img.style.cssText;
          googleLogo.style.display = 'inline-block';
          googleLogo.style.verticalAlign = 'middle';
          googleLogo.innerHTML = '<path fill="#EA4335" d="M115.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18C71.25 34.32 81.24 25 93.5 25s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44S80.99 39.2 80.99 47.18c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path fill="#FBBC05" d="M163.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18c0-12.85 9.99-22.18 22.25-22.18s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44s-12.51 5.46-12.51 13.44c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path fill="#4285F4" d="M209.75 26.34v39.82c0 16.38-9.66 23.07-21.08 23.07-10.75 0-17.22-7.19-19.66-13.07l8.48-3.53c1.51 3.61 5.21 7.87 11.17 7.87 7.31 0 11.84-4.51 11.84-13v-3.19h-.34c-2.18 2.69-6.38 5.04-11.68 5.04-11.09 0-21.25-9.66-21.25-22.09 0-12.52 10.16-22.26 21.25-22.26 5.29 0 9.49 2.35 11.68 4.96h.34v-3.61h9.25zm-8.56 20.92c0-7.81-5.21-13.52-11.84-13.52-6.72 0-12.35 5.71-12.35 13.52 0 7.73 5.63 13.36 12.35 13.36 6.63 0 11.84-5.63 11.84-13.36z"/><path fill="#34A853" d="M225 3v65h-9.5V3h9.5z"/><path fill="#EA4335" d="M262.02 54.48l7.56 5.04c-2.44 3.61-8.32 9.83-18.48 9.83-12.6 0-22.01-9.74-22.01-22.18 0-13.19 9.49-22.18 20.92-22.18 11.51 0 17.14 9.16 18.98 14.11l1.01 2.52-29.65 12.28c2.27 4.45 5.8 6.72 10.75 6.72 4.96 0 8.4-2.44 10.92-6.14zm-23.27-7.98l19.82-8.23c-1.09-2.77-4.37-4.7-8.23-4.7-4.95 0-11.84 4.37-11.59 12.93z"/><path fill="#4285F4" d="M35.29 41.41V32H67c.31 1.64.47 3.58.47 5.68 0 7.06-1.93 15.79-8.15 22.01-6.05 6.3-13.78 9.66-24.02 9.66C16.32 69.35.36 53.89.36 34.91.36 15.93 16.32.47 35.3.47c10.5 0 17.98 4.12 23.6 9.49l-6.64 6.64c-4.03-3.78-9.49-6.72-16.97-6.72-13.86 0-24.7 11.17-24.7 25.03 0 13.86 10.84 25.03 24.7 25.03 8.99 0 14.11-3.61 17.39-6.89 2.66-2.66 4.41-6.46 5.1-11.65l-22.49.01z"/>';
          img.parentNode.replaceChild(googleLogo, img);
        }
      });
    }

    // Defer until section is visible
    const reviewsSection = trustIndexContainer.closest('.reviews-section');
    if (reviewsSection && 'IntersectionObserver' in window) {
      const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
          loadTrustWidget();
          observer.disconnect();
        }
      }, { rootMargin: '200px 0px', threshold: 0 });
      observer.observe(reviewsSection);
    } else {
      loadTrustWidget();
    }
  }
</script>
